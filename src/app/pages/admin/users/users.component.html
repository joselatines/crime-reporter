<main class="bg-[#ece8e8] min-h-screen p-4 sm:p-6 lg:p-8">
  <h1 class="text-3xl font-bold text-[#202c4c] max-w-7xl mx-auto mb-6">
    Gestión de Usuarios
  </h1>

  <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">

    <aside class="lg:col-span-1 lg:sticky lg:top-8 self-start">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-xl font-bold text-[#202c4c] mb-5">
          {{ editMode ? 'Editar Usuario' : 'Agregar Nuevo Usuario' }}
        </h2>
        
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <div>
            <label for="username" class="block text-sm font-medium text-gray-600 mb-1">Nombre de Usuario</label>
            <input id="username" type="text" formControlName="username" placeholder="ej: jsmith"
                   class="block w-full bg-slate-100 border-transparent rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#202c4c]">
            <div *ngIf="userForm.get('username')?.hasError('required') && userForm.get('username')?.touched" class="text-red-600 text-sm mt-1">El nombre de usuario es requerido.</div>
          </div>
          
          <div>
            <label for="email" class="block text-sm font-medium text-gray-600 mb-1">Correo Electrónico</label>
            <input id="email" type="email" formControlName="email" placeholder="ej: j.smith@email.com"
                   class="block w-full bg-slate-100 border-transparent rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#202c4c]">
            <div *ngIf="userForm.get('email')?.hasError('required') && userForm.get('email')?.touched" class="text-red-600 text-sm mt-1">El correo es requerido.</div>
            <div *ngIf="userForm.get('email')?.hasError('email') && userForm.get('email')?.touched" class="text-red-600 text-sm mt-1">Por favor, ingrese un correo válido.</div>
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-gray-600 mb-1">Contraseña</label>
            <input id="password" type="password" formControlName="password" placeholder="••••••••"
                   class="block w-full bg-slate-100 border-transparent rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#202c4c]">
            <div *ngIf="editMode" class="text-gray-500 text-xs mt-1">Dejar en blanco para no cambiar la contraseña.</div>
            <div *ngIf="userForm.get('password')?.hasError('minlength') && userForm.get('password')?.touched" class="text-red-600 text-sm mt-1">La contraseña debe tener al menos 6 caracteres.</div>
          </div>

          <div>
            <label for="role" class="block text-sm font-medium text-gray-600 mb-1">Rol</label>
            <select id="role" formControlName="role"
                    class="block w-full bg-slate-100 border-transparent rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#202c4c]">
              <option value="" disabled>Seleccione un rol</option>
              <option value="detective">Detective</option>
              <option value="admin">Administrador</option>
            </select>
            <div *ngIf="userForm.get('role')?.hasError('required') && userForm.get('role')?.touched" class="text-red-600 text-sm mt-1">El rol es requerido.</div>
          </div>

          <div class="flex justify-end gap-3 pt-4">
            <button *ngIf="editMode" type="button" (click)="cancelEdit()"
                    class="px-4 py-2 rounded-lg font-semibold text-gray-600 hover:bg-slate-100">
              Cancelar
            </button>
            <button type="submit" [disabled]="userForm.invalid && !editMode"
                    class="px-5 py-2 rounded-lg bg-[#202c4c] text-white font-semibold hover:bg-opacity-90 disabled:bg-slate-300 disabled:cursor-not-allowed">
              {{ editMode ? 'Actualizar' : 'Agregar Usuario' }}
            </button>
          </div>
        </form>
      </div>
    </aside>

    <div class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="relative mb-4">
          <input type="text" placeholder="Buscar por nombre, correo o rol" [(ngModel)]="searchTerm" (keyup)="applyFilter()"
                 class="w-full bg-slate-100 border-transparent rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#202c4c]">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table mat-table [dataSource]="filteredUsers" class="w-full">
            <ng-container matColumnDef="username">
              <th mat-header-cell *matHeaderCellDef class="text-left text-sm font-bold text-[#202c4c] py-3 px-4 border-b">Usuario</th>
              <td mat-cell *matCellDef="let user" class="py-3 px-4 border-b text-gray-700">{{user.username}}</td>
            </ng-container>

            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef class="text-left text-sm font-bold text-[#202c4c] py-3 px-4 border-b">Correo Electrónico</th>
              <td mat-cell *matCellDef="let user" class="py-3 px-4 border-b text-gray-700">{{user.email}}</td>
            </ng-container>

            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef class="text-left text-sm font-bold text-[#202c4c] py-3 px-4 border-b">Rol</th>
              <td mat-cell *matCellDef="let user" class="py-3 px-4 border-b">
                <span class="px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="{
                        'bg-slate-100 text-slate-600': user.role === 'detective',
                        'bg-[#202c4c]/10 text-[#202c4c]': user.role === 'admin'
                      }">
                  {{ user.role === 'detective' ? 'Detective' : 'Administrador' }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="text-left text-sm font-bold text-[#202c4c] py-3 px-4 border-b">Acciones</th>
              <td mat-cell *matCellDef="let user" class="py-3 px-4 border-b">
                <div class="flex items-center gap-3">
                  <button (click)="editUser(user)" class="text-gray-400 hover:text-[#202c4c]">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"></path></svg>
                  </button>
                  <button (click)="deleteUser(user)" class="text-gray-400 hover:text-red-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-slate-50 transition-colors"></tr>
            <tr *matNoDataRow>
              <td class="text-center py-8 text-gray-500" [attr.colspan]="displayedColumns.length">No se encontraron usuarios que coincidan con la búsqueda.</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</main>